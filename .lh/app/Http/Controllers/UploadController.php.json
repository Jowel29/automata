{
    "sourceFile": "app/Http/Controllers/UploadController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1762469533584,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762469539176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,8 @@\n             foreach ($request->file('pdfs') as $file) {\n                 // Generate safe filename with timestamp and random string\n                 $filename = time() . '_' . Str::random(10) . '.pdf';\n \n-                // Store using Laravel's Storage facade\n                 $path = $file->storeAs('pdf', $filename, 'public');\n \n                 $uploadedFiles[] = [\n                     'filename' => $filename,\n@@ -41,5 +40,5 @@\n                 ->with('error', 'Upload failed: ' . $e->getMessage())\n                 ->withInput();\n         }\n     }\n-}\n\\ No newline at end of file\n+}\n"
                },
                {
                    "date": 1762470765471,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,69 @@\n <?php\n+\n namespace App\\Http\\Controllers;\n \n use App\\Http\\Requests\\UploadPDFRequest;\n use Illuminate\\Support\\Facades\\Storage;\n use Illuminate\\Support\\Str;\n \n class UploadController extends Controller\n {\n+    /**\n+     * عرض نموذج رفع ملفات PDF\n+     */\n     public function showUploadForm()\n     {\n         return view('pdf.upload');\n     }\n \n+    /**\n+     * معالجة رفع ملفات PDF\n+     */\n     public function uploadPDFs(UploadPDFRequest $request)\n     {\n         $uploadedFiles = [];\n \n         try {\n             foreach ($request->file('pdfs') as $file) {\n                 $filename = time() . '_' . Str::random(10) . '.pdf';\n \n+                // حفظ الملف في public/storage/pdf\n                 $path = $file->storeAs('pdf', $filename, 'public');\n \n                 $uploadedFiles[] = [\n                     'filename' => $filename,\n                     'original_name' => $file->getClientOriginalName(),\n                     'size' => $file->getSize(),\n+                    'path' => $path,\n                 ];\n             }\n \n+            // خزّن المصفوفة في session للصفحة التالية\n             session(['uploaded_pdfs' => $uploadedFiles]);\n \n+            // رسالة نجاح نصية فقط\n             return redirect()->route('pdf.fields')\n                 ->with('success', count($uploadedFiles) . ' file(s) uploaded successfully!');\n \n         } catch (\\Exception $e) {\n+            // رسالة خطأ نصية فقط\n             return redirect()->back()\n                 ->with('error', 'Upload failed: ' . $e->getMessage())\n                 ->withInput();\n         }\n     }\n+\n+    /**\n+     * مسح ملفات PDF المرفوعة من الـ session\n+     * (اختياري، بعد انتهاء الاستخدام)\n+     */\n+    public function clearUploadedFiles()\n+    {\n+        if (session()->has('uploaded_pdfs')) {\n+            foreach (session('uploaded_pdfs') as $pdf) {\n+                Storage::disk('public')->delete($pdf['path']);\n+            }\n+            session()->forget('uploaded_pdfs');\n+        }\n+    }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1762470773322,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,66 @@\n+<?php\n+\n+namespace App\\Http\\Controllers;\n+\n+use App\\Http\\Requests\\UploadPDFRequest;\n+use Illuminate\\Support\\Facades\\Storage;\n+use Illuminate\\Support\\Str;\n+\n+class UploadController extends Controller\n+{\n+    /**\n+     * عرض نموذج رفع ملفات PDF\n+     */\n+    public function showUploadForm()\n+    {\n+        return view('pdf.upload');\n+    }\n+\n+    /**\n+     * معالجة رفع ملفات PDF\n+     */\n+    public function uploadPDFs(UploadPDFRequest $request)\n+    {\n+        $uploadedFiles = [];\n+\n+        try {\n+            foreach ($request->file('pdfs') as $file) {\n+                $filename = time() . '_' . Str::random(10) . '.pdf';\n+\n+                // حفظ الملف في public/storage/pdf\n+                $path = $file->storeAs('pdf', $filename, 'public');\n+\n+                $uploadedFiles[] = [\n+                    'filename' => $filename,\n+                    'original_name' => $file->getClientOriginalName(),\n+                    'size' => $file->getSize(),\n+                    'path' => $path,\n+                ];\n+            }\n+\n+            // خزّن المصفوفة في session للصفحة التالية\n+            session(['uploaded_pdfs' => $uploadedFiles]);\n+\n+            // رسالة نجاح نصية فقط\n+            return redirect()->route('pdf.fields')\n+                ->with('success', count($uploadedFiles) . ' file(s) uploaded successfully!');\n+\n+        } catch (\\Exception $e) {\n+            // رسالة خطأ نصية فقط\n+            return redirect()->back()\n+                ->with('error', 'Upload failed: ' . $e->getMessage())\n+                ->withInput();\n+        }\n+    }\n+\n+\n+    public function clearUploadedFiles()\n+    {\n+        if (session()->has('uploaded_pdfs')) {\n+            foreach (session('uploaded_pdfs') as $pdf) {\n+                Storage::disk('public')->delete($pdf['path']);\n+            }\n+            session()->forget('uploaded_pdfs');\n+        }\n+    }\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1762469533584,
            "name": "Commit-0",
            "content": "<?php\nnamespace App\\Http\\Controllers;\n\nuse App\\Http\\Requests\\UploadPDFRequest;\nuse Illuminate\\Support\\Facades\\Storage;\nuse Illuminate\\Support\\Str;\n\nclass UploadController extends Controller\n{\n    public function showUploadForm()\n    {\n        return view('pdf.upload');\n    }\n\n    public function uploadPDFs(UploadPDFRequest $request)\n    {\n        $uploadedFiles = [];\n\n        try {\n            foreach ($request->file('pdfs') as $file) {\n                // Generate safe filename with timestamp and random string\n                $filename = time() . '_' . Str::random(10) . '.pdf';\n\n                // Store using Laravel's Storage facade\n                $path = $file->storeAs('pdf', $filename, 'public');\n\n                $uploadedFiles[] = [\n                    'filename' => $filename,\n                    'original_name' => $file->getClientOriginalName(),\n                    'size' => $file->getSize(),\n                ];\n            }\n\n            session(['uploaded_pdfs' => $uploadedFiles]);\n\n            return redirect()->route('pdf.fields')\n                ->with('success', count($uploadedFiles) . ' file(s) uploaded successfully!');\n\n        } catch (\\Exception $e) {\n            return redirect()->back()\n                ->with('error', 'Upload failed: ' . $e->getMessage())\n                ->withInput();\n        }\n    }\n}"
        }
    ]
}